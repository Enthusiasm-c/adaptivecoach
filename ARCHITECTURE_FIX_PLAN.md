# ĞŸĞ»Ğ°Ğ½ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹: "ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ĞºĞ¾Ğ»Ñ‘ÑĞ° Ğº Ğ´Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»Ñ"

## Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾, Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ñƒ.

```
Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKOUT LOGS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Volume  â”‚     â”‚  Strength    â”‚     â”‚  Mesocycle   â”‚
    â”‚ Tracker â”‚     â”‚  Analysis    â”‚     â”‚  Service     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                    â”‚
         X                 X                    X
         â”‚                 â”‚                    â”‚
         â–¼                 â–¼                    â–¼
    [ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ UI]   [ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ UI]    [ĞĞ• Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ!]
         â”‚                 â”‚                    â”‚
         X â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ĞĞ• ĞŸĞ•Ğ Ğ•Ğ”ĞĞĞ¢Ğ¡Ğ¯ Ğ’ AI â”€â”€â”€â”€â”€â”€X
```

---

## Ğ¤ĞĞ—Ğ 1: ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (P0)

### 1.1 ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ mesocycle multiplier Ğº UI

**Ğ¤Ğ°Ğ¹Ğ»**: `App.tsx` ÑÑ‚Ñ€Ğ¾ĞºĞ° 746

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´**:
```typescript
<Dashboard
    program={trainingProgram}  // RAW Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°!
    ...
/>
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´**:
```typescript
// ĞŸĞµÑ€ĞµĞ´ return, Ğ¾ĞºĞ¾Ğ»Ğ¾ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 740:
const displayProgram = useMemo(() => {
    if (!trainingProgram || !mesocycleState) return trainingProgram;
    return getProgramForCurrentPhase(trainingProgram, mesocycleState);
}, [trainingProgram, mesocycleState]);

// Ğ’ JSX:
<Dashboard
    program={displayProgram}
    ...
/>
```

**Ğ¢ĞµÑÑ‚**: ĞĞ° 5Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ Ğ¼ĞµĞ·Ğ¾Ñ†Ğ¸ĞºĞ»Ğ° (overreaching) ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ğµ Ñ 3 Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ°Ğ¼Ğ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ 4 Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ° (3 Ã— 1.2 = 3.6 â†’ 4).

---

### 1.2 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ volume analysis Ğ² AI prompt

**Ğ¤Ğ°Ğ¹Ğ»**: `services/geminiService.ts`

**Ğ¨Ğ°Ğ³ A**: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ import (ÑÑ‚Ñ€Ğ¾ĞºĞ° ~15):
```typescript
import { calculateWeeklyVolume, WeeklyVolumeReport } from './volumeTracker';
```

**Ğ¨Ğ°Ğ³ B**: Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ `buildAdaptationPrompt` (ÑÑ‚Ñ€Ğ¾ĞºĞ° ~332):

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´**:
```typescript
function buildAdaptationPrompt(currentProgram: TrainingProgram, logs: WorkoutLog[]): string {
    const recentLogs = logs.slice(-3);
    const exerciseSummary = extractExerciseSummary(recentLogs);
    const painReports = extractPainReports(recentLogs);
    ...
}
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´**:
```typescript
function buildAdaptationPrompt(
    currentProgram: TrainingProgram,
    logs: WorkoutLog[],
    profile?: OnboardingProfile  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ profile Ğ´Ğ»Ñ experience level
): string {
    const recentLogs = logs.slice(-6);  // Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ´Ğ¾ 6 Ğ´Ğ»Ñ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°
    const exerciseSummary = extractExerciseSummary(recentLogs);
    const painReports = extractPainReports(recentLogs);

    // NEW: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ volume analysis
    const experienceLevel = profile?.experience || 'intermediate';
    const volumeReport = calculateWeeklyVolume(recentLogs, experienceLevel);
    const volumeSection = formatVolumeReport(volumeReport);
    ...

    // Ğ’ prompt Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ†Ğ¸Ñ:
    === ĞĞĞĞ›Ğ˜Ğ— ĞĞ‘ĞªĞĞœĞ ĞŸĞ Ğ“Ğ Ğ£ĞŸĞŸĞĞœ ĞœĞ«Ğ¨Ğ¦ ===
    ${volumeSection}
}

// ĞĞ¾Ğ²Ğ°Ñ helper Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ:
function formatVolumeReport(report: WeeklyVolumeReport): string {
    if (report.muscles.length === 0) return 'ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…';

    const lines: string[] = [];

    if (report.undertrainedMuscles.length > 0) {
        lines.push(`âš ï¸ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸: ${report.undertrainedMuscles.join(', ')}`);
    }
    if (report.overtrainedMuscles.length > 0) {
        lines.push(`ğŸ”´ ĞŸĞµÑ€ĞµÑ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: ${report.overtrainedMuscles.join(', ')}`);
    }

    // Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¿Ğ¾ Ğ¼Ñ‹ÑˆÑ†Ğ°Ğ¼
    for (const m of report.muscles) {
        const statusIcon = m.status === 'under' ? 'ğŸ“‰' : m.status === 'over' ? 'ğŸ“ˆ' : 'âœ…';
        lines.push(`${statusIcon} ${m.muscleNameRu}: ${m.totalSets} ÑĞµÑ‚Ğ¾Ğ² (${m.percentOfOptimal}% Ğ¾Ñ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼ÑƒĞ¼Ğ°)`);
    }

    return lines.join('\n    ');
}
```

**Ğ¨Ğ°Ğ³ C**: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ·Ğ¾Ğ² `adaptPlan` Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ profile:

Ğ’ `App.tsx` ÑÑ‚Ñ€Ğ¾ĞºĞ° ~537:
```typescript
const adaptedProgram = await adaptPlan(currentProgram, updatedLogs, onboardingProfile);
```

Ğ’ `geminiService.ts` Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ñ‚ÑƒÑ€Ñƒ:
```typescript
export async function adaptPlan(
    currentProgram: TrainingProgram,
    logs: WorkoutLog[],
    profile?: OnboardingProfile
): Promise<TrainingProgram> {
    const prompt = buildAdaptationPrompt(currentProgram, logs, profile);
    ...
}
```

---

### 1.3 Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ E1RM Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ²ĞµÑĞ¾Ğ²

**Ğ¤Ğ°Ğ¹Ğ»**: `services/programGenerator.ts` Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `calculateInitialWeight`

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´** (ÑÑ‚Ñ€Ğ¾ĞºĞ° ~86-110): Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ `profile.knownWeights` Ğ¸Ğ· Ğ¾Ğ½Ğ±Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ³Ğ°.

**ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´**:
```typescript
import { calculateE1RM, getBestLiftForExercise } from '../utils/strengthAnalysisUtils';

function calculateInitialWeight(
    exercise: ExerciseDefinition,
    profile: OnboardingProfile,
    logs?: WorkoutLog[]  // NEW: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ logs
): number | undefined {
    // For bodyweight exercises, no weight needed
    if (exercise.equipment === 'bodyweight') {
        return undefined;
    }

    // NEW: Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
    if (logs && logs.length > 0) {
        const bestLift = getBestLiftForExercise(exercise.name, logs, profile);
        if (bestLift) {
            // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ 80% Ğ¾Ñ‚ E1RM Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ñ… Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ²
            const workingWeight = Math.round(bestLift.e1rm * 0.8 / 2.5) * 2.5;
            return workingWeight;
        }
    }

    // Fallback: ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ profile.knownWeights
    const normalizedName = normalizeExerciseNameForWeight(exercise.name);
    ...
}
```

**ĞĞ¾Ğ²Ğ°Ñ helper Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ** Ğ² `strengthAnalysisUtils.ts`:
```typescript
export function getBestLiftForExercise(
    exerciseName: string,
    logs: WorkoutLog[],
    profile: OnboardingProfile
): { weight: number; reps: number; e1rm: number } | null {
    const normalizedTarget = exerciseName.toLowerCase();

    let bestE1rm = 0;
    let bestLift = null;

    for (const log of logs) {
        for (const ex of log.completedExercises) {
            if (ex.isWarmup) continue;

            const normalizedName = ex.name.toLowerCase();
            // Fuzzy match
            if (normalizedName.includes(normalizedTarget) ||
                normalizedTarget.includes(normalizedName)) {

                for (const set of ex.completedSets) {
                    if (set.weight && set.reps && set.reps > 0) {
                        const e1rm = calculateE1RM(set.weight, set.reps);
                        if (e1rm > bestE1rm) {
                            bestE1rm = e1rm;
                            bestLift = { weight: set.weight, reps: set.reps, e1rm };
                        }
                    }
                }
            }
        }
    }

    return bestLift;
}
```

---

## Ğ¤ĞĞ—Ğ 2: Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (P1)

### 2.1 Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ĞµÑĞ° ĞŸĞ•Ğ Ğ•Ğ” Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸ĞµĞ¹

**Ğ¤Ğ°Ğ¹Ğ»**: `App.tsx`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: `syncWeightsFromLogs` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ ĞŸĞĞ¡Ğ›Ğ• Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸, Ğ½Ğ¾ ĞŸĞ•Ğ Ğ•Ğ” Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ¼ AI `adaptPlan`.

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´** (ÑÑ‚Ñ€Ğ¾ĞºĞ° ~537):
```typescript
const adaptedProgram = await adaptPlan(currentProgram, updatedLogs);
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´**:
```typescript
// Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ Ñ‡Ñ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ synced program Ğ´Ğ»Ñ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ğ¸
const syncedForAdaptation = syncWeightsFromLogs(currentProgram, updatedLogs);
const adaptedProgram = await adaptPlan(syncedForAdaptation, updatedLogs, onboardingProfile);
```

---

### 2.2 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€ĞµĞ³ÑƒĞ»ÑÑ†Ğ¸Ğ¸ Ğ² UI

**Ğ¤Ğ°Ğ¹Ğ»**: `App.tsx` ÑÑ‚Ñ€Ğ¾ĞºĞ° ~524

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´**:
```typescript
if (recommendation.warnings.length > 0) {
    setToastMessage(recommendation.warnings[0]);
}
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´**:
```typescript
// Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
const adjustmentExplanation = formatAutoregulationMessage(recommendation);
if (adjustmentExplanation) {
    setToastMessage(adjustmentExplanation);
}

// ĞĞ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ:
function formatAutoregulationMessage(rec: AutoregulationRecommendation): string | null {
    if (rec.volumeAdjustment.type === 'maintain') return null;

    const direction = rec.volumeAdjustment.type === 'increase' ? 'Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ»' : 'Ğ¡Ğ½Ğ¸Ğ·Ğ¸Ğ»';
    const percent = Math.abs(rec.volumeAdjustment.percent);

    let reason = '';
    if (rec.warnings.length > 0) {
        reason = rec.warnings[0];
    } else if (rec.volumeAdjustment.type === 'decrease') {
        reason = 'ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸ Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ ÑƒÑÑ‚Ğ°Ğ»Ğ¾ÑÑ‚Ğ¸';
    } else {
        reason = 'Ğ¢Ñ‹ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ±Ğ¾Ğ»ÑŒÑˆĞµĞ¹ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ!';
    }

    return `${direction} Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºÑƒ Ğ½Ğ° ${percent}%. ${reason}`;
}
```

---

### 2.3 Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ÑĞ±Ğ¾Ñ€ RIR (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ğ¸)

**Ğ¤Ğ°Ğ¹Ğ»**: `components/WorkoutView.tsx`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: RIR input Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (ÑÑ‚Ñ€Ğ¾ĞºĞ° ~873).

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: Ğ’Ğ¼ĞµÑÑ‚Ğ¾ ÑÑ‚ĞµĞ¿Ğ¿ĞµÑ€Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ dropdown:

```typescript
{/* RIR Selection - Compact dropdown */}
<select
    value={set.rir ?? ''}
    onChange={(e) => handleValueChange(currentExerciseIndex, setIndex, 'rir',
        e.target.value === '' ? undefined : Number(e.target.value))}
    className="w-14 h-8 rounded-lg bg-neutral-800 text-white text-xs text-center border border-white/10"
>
    <option value="">RIR</option>
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3+</option>
</select>
```

---

## Ğ¤ĞĞ—Ğ 3: ĞŸĞ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° (P2)

### 3.1 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ UserCapabilitiesSnapshot

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»**: `services/userCapabilities.ts`

```typescript
import { OnboardingProfile, WorkoutLog, TrainingProgram } from '../types';
import { calculateWeeklyVolume } from './volumeTracker';
import { calculateStrengthAnalysis, detectImbalances, analyzePainPatterns } from '../utils/strengthAnalysisUtils';
import { syncWeightsFromLogs } from '../utils/weightSync';

export interface UserCapabilitiesSnapshot {
    profile: OnboardingProfile;
    program: TrainingProgram;
    recentLogs: WorkoutLog[];

    // Calculated capabilities
    volumeReport: WeeklyVolumeReport;
    strengthAnalysis: StrengthAnalysis[];
    imbalances: ImbalanceReport[];
    painPatterns: PainPattern[];
    bestLifts: Map<string, { weight: number; reps: number; e1rm: number }>;

    // Program with actual weights
    syncedProgram: TrainingProgram;
}

export function createCapabilitiesSnapshot(
    profile: OnboardingProfile,
    program: TrainingProgram,
    logs: WorkoutLog[]
): UserCapabilitiesSnapshot {
    const recentLogs = logs.slice(-6);

    return {
        profile,
        program,
        recentLogs,
        volumeReport: calculateWeeklyVolume(recentLogs, profile.experience),
        strengthAnalysis: calculateStrengthAnalysis(logs, profile),
        imbalances: detectImbalances(logs, profile),
        painPatterns: analyzePainPatterns(logs),
        bestLifts: getBestLifts(logs, profile),
        syncedProgram: syncWeightsFromLogs(program, logs),
    };
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² geminiService.ts**:
```typescript
export async function adaptPlan(
    program: TrainingProgram,
    logs: WorkoutLog[],
    profile: OnboardingProfile
): Promise<TrainingProgram> {
    const capabilities = createCapabilitiesSnapshot(profile, program, logs);
    const prompt = buildAdaptationPromptFromCapabilities(capabilities);
    ...
}
```

---

### 3.2 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»**: `services/__tests__/integration.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { createCapabilitiesSnapshot } from '../userCapabilities';
import { adaptPlan } from '../geminiService';
import { mockProfile, mockLogs, mockProgram } from '../../test/fixtures';

describe('User Capabilities Flow', () => {
    it('should include volume report in adaptation prompt', async () => {
        const snapshot = createCapabilitiesSnapshot(mockProfile, mockProgram, mockLogs);

        expect(snapshot.volumeReport.muscles.length).toBeGreaterThan(0);
        expect(snapshot.strengthAnalysis.length).toBeGreaterThan(0);
    });

    it('should use best lifts for weight suggestions', () => {
        const snapshot = createCapabilitiesSnapshot(mockProfile, mockProgram, mockLogs);

        // User did bench press at 80kg x 8 = E1RM ~100kg
        const benchLift = snapshot.bestLifts.get('Ğ¶Ğ¸Ğ¼ Ğ»ĞµĞ¶Ğ°');
        expect(benchLift).toBeDefined();
        expect(benchLift!.e1rm).toBeGreaterThan(80);
    });

    it('should apply mesocycle multiplier to displayed program', () => {
        const mesocycleState = {
            weekNumber: 5, // overreaching
            mesocycle: { volumeMultiplier: 1.2 }
        };

        const displayProgram = getProgramForCurrentPhase(mockProgram, mesocycleState);
        const originalSets = mockProgram.sessions[0].exercises[0].sets;
        const displayedSets = displayProgram.sessions[0].exercises[0].sets;

        expect(displayedSets).toBe(Math.ceil(originalSets * 1.2));
    });
});
```

---

## ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

| ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° | Ğ¤Ğ°Ğ¹Ğ»Ñ‹ | Ğ’Ñ€ĞµĞ¼Ñ |
|-----------|--------|-------|-------|
| P0.1 | Mesocycle â†’ UI | App.tsx | 15 Ğ¼Ğ¸Ğ½ |
| P0.2 | Volume â†’ AI prompt | geminiService.ts | 30 Ğ¼Ğ¸Ğ½ |
| P0.3 | E1RM â†’ weights | programGenerator.ts, strengthAnalysisUtils.ts | 45 Ğ¼Ğ¸Ğ½ |
| P1.1 | Sync before adapt | App.tsx | 10 Ğ¼Ğ¸Ğ½ |
| P1.2 | Autoregulation explanation | App.tsx | 20 Ğ¼Ğ¸Ğ½ |
| P1.3 | Enable RIR | WorkoutView.tsx | 30 Ğ¼Ğ¸Ğ½ |
| P2.1 | UserCapabilitiesSnapshot | ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» | 1 Ñ‡Ğ°Ñ |
| P2.2 | Integration tests | ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» | 1 Ñ‡Ğ°Ñ |

---

## ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

```
ĞŸĞ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKOUT LOGS   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         UserCapabilitiesSnapshot            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚  â”‚ Volume   â”‚ Strength â”‚ Pain     â”‚        â”‚
    â”‚  â”‚ Report   â”‚ Analysis â”‚ Patterns â”‚        â”‚
    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          â”‚          â”‚
            â–¼          â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      AI ADAPTATION PROMPT          â”‚
    â”‚   (ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ!)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           NEW PROGRAM              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            getProgramForCurrentPhase()
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DASHBOARD (Ñ mesocycle volume)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ğ”Ğ²Ğ¸Ğ³Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğº ĞºĞ¾Ğ»Ñ‘ÑĞ°Ğ¼. Ferrari ĞµĞ´ĞµÑ‚!**
